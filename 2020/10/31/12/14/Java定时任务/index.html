<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="">
  <script src=""></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"isdear.github.io","root":"/","scheme":"Pisces","version":"8.2.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Java定时任务用来处理一些同步或者定期的业务逻辑计算">
<meta property="og:type" content="article">
<meta property="og:title" content="Java定时任务">
<meta property="og:url" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/index.html">
<meta property="og:site_name" content="The past guides the present and the present determines the future">
<meta property="og:description" content="Java定时任务用来处理一些同步或者定期的业务逻辑计算">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/TimerDemo.png">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/TimerInterface.png">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Timer2.png">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Timer3.png">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/ScheduledExecutorService.jpg">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Schedule1.png">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Schedule2.png">
<meta property="og:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Schedule3.png">
<meta property="article:published_time" content="2020-10-31T04:14:09.000Z">
<meta property="article:modified_time" content="2020-11-01T15:17:34.514Z">
<meta property="article:author" content="Kuang">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/TimerDemo.png">


<link rel="canonical" href="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java定时任务 | The past guides the present and the present determines the future</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">The past guides the present and the present determines the future</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-类别">

    <a href="/categories/" rel="section"><i class="categories fa-fw"></i>类别</a>

  </li>
        <li class="menu-item menu-item-档案">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>档案</a>

  </li>
        <li class="menu-item menu-item-特效">

    <a href="/personality/" rel="section"><i class="about fa-fw"></i>特效</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#Timer%E5%92%8CTimerTask"><span class="nav-number">1.</span> <span class="nav-text">Timer和TimerTask</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Timer%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.1.</span> <span class="nav-text">Timer接口</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Timer-%E5%8A%A3%E5%8A%BF"><span class="nav-number">1.2.</span> <span class="nav-text">Timer 劣势</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.3.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%AD%89%E5%BE%85"><span class="nav-number">1.4.</span> <span class="nav-text">利用线程的等待</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ScheduledExecutorService"><span class="nav-number">2.</span> <span class="nav-text">ScheduledExecutorService</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B1"><span class="nav-number">2.1.</span> <span class="nav-text">示例1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B2"><span class="nav-number">2.2.</span> <span class="nav-text">示例2</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6-Quartz"><span class="nav-number">3.</span> <span class="nav-text">三方框架 Quartz</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B1-1"><span class="nav-number">3.1.</span> <span class="nav-text">示例1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B2-1"><span class="nav-number">3.2.</span> <span class="nav-text">示例2</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kuang"
      src="/images/kenan.jpg">
  <p class="site-author-name" itemprop="name">Kuang</p>
  <div class="site-description" itemprop="description">个人博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Isdear" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Isdear" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kuang8421@qq.com" title="E-Mail → mailto:kuang8421@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/269017831" title="B站 → https:&#x2F;&#x2F;space.bilibili.com&#x2F;269017831" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>B站</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1906956615" title="QQ → 1906956615"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/kenan.jpg">
      <meta itemprop="name" content="Kuang">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The past guides the present and the present determines the future">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java定时任务
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-31 12:14:09" itemprop="dateCreated datePublished" datetime="2020-10-31T12:14:09+08:00">2020-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-01 23:17:34" itemprop="dateModified" datetime="2020-11-01T23:17:34+08:00">2020-11-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="far fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>38 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Java定时任务用来处理一些同步或者定期的业务逻辑计算<a id="more"></a></p>
<p>Java 系统中主要有三种方式来实现定时任务：</p>
<ul>
<li><p>Timer和TimerTask</p>
</li>
<li><p>ScheduledExecutorService</p>
</li>
<li><p>三方框架 Quartz</p>
</li>
</ul>
<h5 id="Timer和TimerTask"><a href="#Timer和TimerTask" class="headerlink" title="Timer和TimerTask"></a>Timer和TimerTask</h5><p>通过一个demo分析原理</p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/TimerDemo.png" alt></p>
<p>这种方式的定时任务主要用到两个类，Timer 和 TimerTask。其中，TimerTask 继承接口 Runnable，抽象的描述一种任务类型，我们只要重写实现它的 run 方法就可以实现自定义任务。</p>
<p>而 Timer 就是用于定时任务调度的核心类，demo 中我们调用其 schedule 并指定延时 1000 毫秒，所以上述代码会在一秒钟后完成打印操作，接着程序结束。</p>
<h6 id="Timer接口"><a href="#Timer接口" class="headerlink" title="Timer接口"></a>Timer接口</h6><p>首先，Timer 接口中，这两个字段是非常核心重要的：</p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/TimerInterface.png" alt></p>
<p>TaskQueue 是一个队列，内部由动态数组实现的最小堆结构，换句话说，它是一个优先级队列。而优先级参考下一次执行时间，越快执行的越排在前面，这一点我们回头再研究。</p>
<p>接着，这个 TimerThread 类其实是 Timer 的一个内部类，它继承了 Thread 并重写了其 run 方法，该线程实例将在构建 Timer 实例的时候被启动。</p>
<p>run 方法内部会循环的从队列中取任务，如果没有就阻塞自己，而当我们成功的向队列中添加了定时任务，也会尝试唤醒该线程。</p>
<p>我们也来看一下 Timer 的构造方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Timer</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"> thread.setName(name);</span><br><span class="line"> thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再简单不过的构造函数了，为内部线程设置线程名，并启动该线程。</p>
<p>最后，我们着重看一下 Timer 中用于配置一个定时任务进任务队列的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在时刻 time 处执行任务</span></span><br><span class="line">schedule(TimerTask task, Date time)</span><br><span class="line"></span><br><span class="line"><span class="comment">//延时 delay 毫秒后执行任务</span></span><br><span class="line">schedule(TimerTask task, <span class="keyword">long</span> delay)</span><br><span class="line"></span><br><span class="line"><span class="comment">//固定延时重复执行，firstTime为首次执行时间，</span></span><br><span class="line"><span class="comment">//往后没间隔 period 毫秒执行一次</span></span><br><span class="line">schedule(TimerTask task, Date firstTime, <span class="keyword">long</span> period)</span><br><span class="line"></span><br><span class="line"><span class="comment">//固定延时重复执行</span></span><br><span class="line"><span class="comment">//首次执行时间为当前时间延时 delay 毫秒</span></span><br><span class="line">schedule(TimerTask task, <span class="keyword">long</span> delay, <span class="keyword">long</span> period)</span><br><span class="line"></span><br><span class="line"><span class="comment">//固定频率重复执行，每过 period 毫秒执行一次</span></span><br><span class="line">scheduleAtFixedRate(TimerTask task, Date firstTime, <span class="keyword">long</span> period)</span><br><span class="line"></span><br><span class="line"><span class="comment">//固定频率重复执行</span></span><br><span class="line">scheduleAtFixedRate(TimerTask task, <span class="keyword">long</span> delay, <span class="keyword">long</span> period)</span><br></pre></td></tr></table></figure>
<p>相信有了注释，这几个方法的区别与作用应该不难理解，但是其中有两个概念需要作一点区分。</p>
<p><strong>固定延时== VS ==固定频率</strong></p>
<p>固定延时：以任务的上一次 实际 执行时间做参考，往后延时 period 毫秒。</p>
<p>固定频率：任务的往后每一次执行时间都在任务提交的那一刻得到了确定，不论你上次任务是否意外延时了，定时定点执行下一次任务。</p>
<p>这两者的区别还是很大的，希望你能够理解清楚，接着我们以其中一个方法为例，看看底层实现。</p>
<p>以这个方法为例，其他重载方法的底层调用都是同样的，我们不去赘述。</p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Timer2.png" alt></p>
<p>这个方法的作用，我们再说一遍。</p>
<p>以当前时间为准，延时 delay 毫秒后第一次执行该任务，并且采取固定延时的方式，每隔 period 毫秒再次执行该任务。</p>
<p>开头的两个异常判断我们不再赘述，看看 sched 方法：</p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Timer3.png" alt></p>
<p>方法需要传入三个参数，参数 task 代表的需要执行的任务体，TimerTask 我们回头会详细介绍，这里你知道它代表了一个任务体即可。</p>
<p>参数 time 描述了该任务下一次执行的时刻，计算机底层是以毫秒描述时刻的，所以这里转换为 long 类型来描述时刻。</p>
<p>参数 period 是固定延时的毫秒数。</p>
<p>整个方法的逻辑我们可以总结概括一下：</p>
<ol>
<li>首先使用任务队列的内置对象锁，锁住个队列。</li>
<li>接着再去锁住我们的 task，并修改其内部的一些属性字段值，nextExecutionTime 指明下一次任务执行时间，period 设置固定延时的毫秒数，修改 state 状态为计划中。</li>
<li>然后将 task 添加到任务队列，其中 add 方法内部会进行最小堆重构，参考的就是 nextExecutionTime 字段的值，越小优先级越高。</li>
<li>判断如果自己就是队列第一个任务，那么将唤醒 Timer 中阻塞了的任务线程。</li>
</ol>
<p>可能会有人疑问，Timer 如何判断一个任务是否是重复执行的，还是单次执行就结束的？</p>
<p>答案在 TimerThread 的 run 方法里。</p>
<p>当我们构造 Timer 实例的时候，就会启动该线程，该线程会在一个死循环中尝试从任务队列上获取任务，如果成功获取就执行该任务并在执行结束之后做一个判断。如果 period 值为零，则说明这是一次普通任务，执行结束后将从队列首部移除该任务。如果 period 为负值，则说明这是一次固定延时的任务，修改它下次执行时间 nextExecutionTime 为当前时间减去 period，重构任务队列。如果 period 为正数，则说明这是一次固定频率的任务，修改它下次执行时间为 上次执行时间加上 period，并重构任务队列。</p>
<h6 id="Timer-劣势"><a href="#Timer-劣势" class="headerlink" title="Timer 劣势"></a>Timer 劣势</h6><ul>
<li>Timer 的背后只有一个线程，不管你有多少个任务，都只有一个工作线程，效率上必然是要打折扣的。</li>
<li>限于单线程，如果第一个任务逻辑上死循环了，后续的任务一个都得不到执行。</li>
<li>依然是由于单线程，任一任务抛出异常后，整个 Timer 就会结束，后续任务全部都无法执行。</li>
</ul>
<p>所以你看，单线程的 Timer 带来了太多局限性，于是我们看它的替代者。</p>
<p>PS： TimerTask 这个抽象任务类的，就是增加了两个字段，一个用于记录下一次该任务的执行时间，一个用于延时毫秒数。只需要重写其 run 方法即可。</p>
<h6 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Calendar;  </span><br><span class="line"><span class="keyword">import</span> java.util.Date;  </span><br><span class="line"><span class="keyword">import</span> java.util.Timer;  </span><br><span class="line"><span class="keyword">import</span> java.util.TimerTask;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//timer1();  </span></span><br><span class="line">        timer2();  </span><br><span class="line">        <span class="comment">//timer3();  </span></span><br><span class="line">        <span class="comment">//timer4();  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 第一种方法：设定指定任务task在指定时间time执行 schedule(TimerTask task, Date time)  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">timer1</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();  </span><br><span class="line">        timer.schedule(<span class="keyword">new</span> TimerTask() &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;-------设定要指定任务--------&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, <span class="number">2000</span>);<span class="comment">// 设定指定的时间time,此处为2000毫秒  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 第二种方法：设定指定任务task在指定延迟delay后进行固定延迟peroid的执行  </span></span><br><span class="line">    <span class="comment">// schedule(TimerTask task, long delay, long period)  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">timer2</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();  </span><br><span class="line">        timer.schedule(<span class="keyword">new</span> TimerTask() &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;-------设定要指定任务--------&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, <span class="number">1000</span>, <span class="number">1000</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 第三种方法：设定指定任务task在指定延迟delay后进行固定频率peroid的执行。  </span></span><br><span class="line">    <span class="comment">// scheduleAtFixedRate(TimerTask task, long delay, long period)  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">timer3</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();  </span><br><span class="line">        timer.scheduleAtFixedRate(<span class="keyword">new</span> TimerTask() &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;-------设定要指定任务--------&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, <span class="number">1000</span>, <span class="number">2000</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">     </span><br><span class="line">    <span class="comment">// 第四种方法：安排指定的任务task在指定的时间firstTime开始进行重复的固定速率period执行．  </span></span><br><span class="line">    <span class="comment">// Timer.scheduleAtFixedRate(TimerTask task,Date firstTime,long period)  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">timer4</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        Calendar calendar = Calendar.getInstance();  </span><br><span class="line">        calendar.set(Calendar.HOUR_OF_DAY, <span class="number">12</span>); <span class="comment">// 控制时  </span></span><br><span class="line">        calendar.set(Calendar.MINUTE, <span class="number">0</span>);       <span class="comment">// 控制分  </span></span><br><span class="line">        calendar.set(Calendar.SECOND, <span class="number">0</span>);       <span class="comment">// 控制秒  </span></span><br><span class="line">  </span><br><span class="line">        Date time = calendar.getTime();         <span class="comment">// 得出执行任务的时间,此处为今天的12：00：00  </span></span><br><span class="line">  </span><br><span class="line">        Timer timer = <span class="keyword">new</span> Timer();  </span><br><span class="line">        timer.scheduleAtFixedRate(<span class="keyword">new</span> TimerTask() &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;-------设定要指定任务--------&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, time, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);<span class="comment">// 这里设定将延时每天固定执行  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<h6 id="利用线程的等待"><a href="#利用线程的等待" class="headerlink" title="利用线程的等待"></a>利用线程的等待</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 普通thread  </span></span><br><span class="line"><span class="comment"> * 这是最常见的，创建一个thread，然后让它在while循环里一直运行着，  </span></span><br><span class="line"><span class="comment"> * 通过sleep方法来达到定时任务的效果。这样可以快速简单的实现，代码如下：  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> GT  </span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task1</span> </span>&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;    </span><br><span class="line">        <span class="comment">// run in a second    </span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> timeInterval = <span class="number">1000</span>;    </span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;    </span><br><span class="line">                    <span class="comment">// ------- code for task to run    </span></span><br><span class="line">                    System.out.println(<span class="string">&quot;Hello !!&quot;</span>);    </span><br><span class="line">                    <span class="comment">// ------- ends here    </span></span><br><span class="line">                    <span class="keyword">try</span> &#123;    </span><br><span class="line">                        Thread.sleep(timeInterval);    </span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;    </span><br><span class="line">                        e.printStackTrace();    </span><br><span class="line">                    &#125;    </span><br><span class="line">                &#125;    </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;;    </span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);    </span><br><span class="line">        thread.start();    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>


<h5 id="ScheduledExecutorService"><a href="#ScheduledExecutorService" class="headerlink" title="ScheduledExecutorService"></a>ScheduledExecutorService</h5><p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/ScheduledExecutorService.jpg" alt></p>
<p>它是我们异步框架中的接口</p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Schedule1.png" alt></p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Schedule2.png" alt></p>
<p>ScheduledExecutorService中定义的这四个接口方法和 Timer 中对应的方法几乎一样，只不过 Timer 的 scheduled 方法需要在外部传入一个 TimerTask 的抽象任务。</p>
<p>而我们的 ScheduledExecutorService 封装的更加细致了，随便你传 Runnable 或是 Callable，我会在内部给你做一层封装，封装一个类似 TimerTask 的抽象任务类（ScheduledFutureTask）。</p>
<p>然后传入线程池，启动线程去执行该任务，而我们的 ScheduledFutureTask 重写的 run 方法是这样的：</p>
<p><img src="/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/Schedule3.png" alt></p>
<h6 id="示例1"><a href="#示例1" class="headerlink" title="示例1"></a>示例1</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line">        scheduledThreadPool.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;=========================&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1000</span>, <span class="number">2000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"> </span><br><span class="line">        scheduledThreadPool.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(System.currentTimeMillis()+<span class="string">&quot;&lt;&gt;&lt;&gt;&quot;</span>+System.nanoTime());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1000</span>, <span class="number">2000</span>, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure>
<h6 id="示例2"><a href="#示例2" class="headerlink" title="示例2"></a>示例2</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;    </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;    </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;    </span><br><span class="line">    </span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * ScheduledExecutorService是从Java SE5的java.util.concurrent里，做为并发工具类被引进的，这是最理想的定时任务实现方式。   </span></span><br><span class="line"><span class="comment"> * 相比于上两个方法，它有以下好处：  </span></span><br><span class="line"><span class="comment"> * 1&gt;相比于Timer的单线程，它是通过线程池的方式来执行任务的   </span></span><br><span class="line"><span class="comment"> * 2&gt;可以很灵活的去设定第一次执行任务delay时间  </span></span><br><span class="line"><span class="comment"> * 3&gt;提供了良好的约定，以便设定执行的时间间隔  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * 下面是实现代码，我们通过ScheduledExecutorService#scheduleAtFixedRate展示这个例子，通过代码里参数的控制，首次执行加了delay时间。  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> GT  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task3</span> </span>&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;    </span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">                <span class="comment">// task to run goes here    </span></span><br><span class="line">                System.out.println(<span class="string">&quot;Hello !!&quot;</span>);    </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;;    </span><br><span class="line">        ScheduledExecutorService service = Executors    </span><br><span class="line">                .newSingleThreadScheduledExecutor();    </span><br><span class="line">        <span class="comment">// 第二个参数为首次执行的延时时间，第三个参数为定时执行的间隔时间    </span></span><br><span class="line">        service.scheduleAtFixedRate(runnable, <span class="number">10</span>, <span class="number">1</span>, TimeUnit.SECONDS);    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>
<h5 id="三方框架-Quartz"><a href="#三方框架-Quartz" class="headerlink" title="三方框架 Quartz"></a>三方框架 Quartz</h5><p>Quartz 是一个功能完善的任务调度框架，支持集群环境下的任务调度，需要将任务调度状态序列化到数据库。</p>
<p>CronTrigger配置格式:</p>
<p>格式: [秒] [分] [小时] [日] [月] [周] [年]</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>说明</th>
<th>是否必填</th>
<th>允许填写的值</th>
<th>允许的通配符</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>秒</td>
<td>是</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>2</td>
<td>分</td>
<td>是</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>3</td>
<td>小时</td>
<td>是</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>4</td>
<td>日</td>
<td>是</td>
<td>1-31</td>
<td>, - * ? / L W</td>
</tr>
<tr>
<td>5</td>
<td>月</td>
<td>是</td>
<td>1-12 or JAN-DEC</td>
<td>, - * /</td>
</tr>
<tr>
<td>6</td>
<td>周</td>
<td>是</td>
<td>1-7 or SUN-SAT</td>
<td>, - * ? / L #</td>
</tr>
<tr>
<td>7</td>
<td>年</td>
<td>否</td>
<td>empty 或 1970-2099</td>
<td>, - * /</td>
</tr>
</tbody></table>
<p>通配符说明:</p>
<p> <code>*</code>表示所有值。例如:在分的字段上设置 “*”,表示每一分钟都会触发。</p>
<p><em><code>?</code> 表示不指定值。使用的场景为不需要关心当前设置这个字段的值。例如:要在每月的10号触发一个操作，但不关心是周几，所以需要周位置的那个字段设置为”?” 具体设置为 0 0 0 10</em> ?</p>
<p><code>-</code> 表示区间。例如 在小时上设置 “10-12”,表示 10,11,12点都会触发。</p>
<p><code>,</code> 表示指定多个值，例如在周字段上设置 “MON,WED,FRI” 表示周一，周三和周五触发。</p>
<p><code>/</code>  用于递增触发。如在秒上面设置”5/15” 表示从5秒开始，每增15秒触发(5,20,35,50)。在月字段上设置’1/3’所示每月1号开始，每隔三天触发一次。</p>
<p><code>L</code> 表示最后的意思。在日字段设置上，表示当月的最后一天(依据当前月份，如果是二月还会依据是否是润年[leap]), 在周字段上表示星期六，相当于”7”或”SAT”。如果在”L”前加上数字，则表示该数据的最后一个。例如在周字段上设置”6L”这样的格式,则表示“本月最后一个星期五”。</p>
<p><code>W</code> 表示离指定日期的最近那个工作日(周一至周五). 例如在日字段上设置”15W”，表示离每月15号最近的那个工作日触发。如果15号正好是周六，则找最近的周五(14号)触发, 如果15号是周未，则找最近的下周一(16号)触发.如果15号正好在工作日(周一至周五)，则就在该天触发。如果指定格式为 “1W”,它则表示每月1号往后最近的工作日触发。如果1号正是周六，则将在3号下周一触发。(注，”W”前只能设置具体的数字,不允许区间”-“)。</p>
<p>[^]: ‘L’和 ‘W’可以一组合使用。如果在日字段上设置”LW”,则表示在本月的最后一个工作日触发</p>
<p><code>#</code>序号(表示每月的第几个周几)，例如在周字段上设置”6#3”表示在每月的第三个周六.注意如果指定”#5”,正好第五周没有周六，则不会触发该配置。</p>
<p>[^]: 周字段的设置，若使用英文字母是不区分大小写的 MON 与mon相同。</p>
<p>常用示例:</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0 0 12 * * ?</td>
<td>每天12点触发</td>
</tr>
<tr>
<td>0 15 10 ? * *</td>
<td>每天10点15分触发</td>
</tr>
<tr>
<td>0 15 10 * * ?</td>
<td>每天10点15分触发</td>
</tr>
<tr>
<td>0 15 10 * * ? *</td>
<td>每天10点15分触发</td>
</tr>
<tr>
<td>0 15 10 * * ? 2005</td>
<td>2005年每天10点15分触发</td>
</tr>
<tr>
<td>0 * 14 * * ?</td>
<td>每天下午的 2点到2点59分每分触发</td>
</tr>
<tr>
<td>0 0/5 14 * * ?</td>
<td>每天下午的 2点到2点59分(整点开始，每隔5分触发)</td>
</tr>
<tr>
<td>0 0/5 14,18 * * ?</td>
<td>每天下午的 2点到2点59分(整点开始，每隔5分触发)每天下午的 18点到18点59分(整点开始，每隔5分触发)</td>
</tr>
<tr>
<td>0 0-5 14 * * ?</td>
<td>每天下午的 2点到2点05分每分触发</td>
</tr>
<tr>
<td>0 10,44 14 ? 3 WED</td>
<td>3月分每周三下午的 2点10分和2点44分触发</td>
</tr>
<tr>
<td>0 15 10 ? * MON-FRI</td>
<td>从周一到周五每天上午的10点15分触发</td>
</tr>
<tr>
<td>0 15 10 15 * ?</td>
<td>每月15号上午10点15分触发</td>
</tr>
<tr>
<td>0 15 10 L * ?</td>
<td>每月最后一天的10点15分触发</td>
</tr>
<tr>
<td>0 15 10 ? * 6L</td>
<td>每月最后一周的星期五的10点15分触发</td>
</tr>
<tr>
<td>0 15 10 ? * 6L 2002-2005</td>
<td>从2002年到2005年每月最后一周的星期五的10点15分触发</td>
</tr>
<tr>
<td>0 15 10 ? * 6#3</td>
<td>每月的第三周的星期五开始触发</td>
</tr>
<tr>
<td>0 0 12 1/5 * ?</td>
<td>每月的第一个中午开始每隔5天触发一次</td>
</tr>
<tr>
<td>0 11 11 11 11 ?</td>
<td>每年的11月11号 11点11分触发</td>
</tr>
</tbody></table>
<h6 id="示例1-1"><a href="#示例1-1" class="headerlink" title="示例1"></a>示例1</h6><p>要使用Quartz，必须要引入以下这几个包：</p>
<p>　　1、log4j-1.2.16</p>
<p>　　2、quartz-2.1.7</p>
<p>　　3、slf4j-api-1.6.1.jar</p>
<p>　　4、slf4j-log4j12-1.6.1.jar</p>
<p>创建要被定执行的任务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;   </span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> java.util.Date;   </span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> org.quartz.Job;   </span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;   </span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;   </span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;   </span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span>   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext arg0)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;   </span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);   </span><br><span class="line">        System.out.println(sdf.format(<span class="keyword">new</span> Date()));   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
<p>创建任务调度，并执行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;  </span><br><span class="line"><span class="keyword">import</span> java.util.Date;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.quartz.CronTrigger;  </span><br><span class="line"><span class="keyword">import</span> org.quartz.JobDetail;  </span><br><span class="line"><span class="keyword">import</span> org.quartz.Scheduler;  </span><br><span class="line"><span class="keyword">import</span> org.quartz.SchedulerFactory;  </span><br><span class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        <span class="comment">// 首先，必需要取得一个Scheduler的引用  </span></span><br><span class="line">        SchedulerFactory sf = <span class="keyword">new</span> StdSchedulerFactory();  </span><br><span class="line">        Scheduler sched = sf.getScheduler();  </span><br><span class="line">        String time=<span class="string">&quot;0 51 11 ? * *&quot;</span>;  </span><br><span class="line">        <span class="comment">// jobs可以在scheduled的sched.start()方法前被调用  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">// job 1将每隔20秒执行一次  </span></span><br><span class="line">        JobDetail job = <span class="keyword">new</span> JobDetail(<span class="string">&quot;job1&quot;</span>, <span class="string">&quot;group1&quot;</span>, myJob.class);  </span><br><span class="line">        CronTrigger trigger = <span class="keyword">new</span> CronTrigger(<span class="string">&quot;trigger1&quot;</span>, <span class="string">&quot;group1&quot;</span>);  </span><br><span class="line">        trigger.setCronExpression(time);  </span><br><span class="line">        Date ft = sched.scheduleJob(job, trigger);  </span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);  </span><br><span class="line">        System.out.println(  </span><br><span class="line">                job.getKey() + <span class="string">&quot; 已被安排执行于: &quot;</span> + sdf.format(ft) + <span class="string">&quot;，并且以如下重复规则重复执行: &quot;</span> + trigger.getCronExpression());  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// job 2将每2分钟执行一次（在该分钟的第15秒)  </span></span><br><span class="line">        job = <span class="keyword">new</span> JobDetail(<span class="string">&quot;job2&quot;</span>, <span class="string">&quot;group1&quot;</span>,myJob.class);  </span><br><span class="line">        trigger = <span class="keyword">new</span> CronTrigger(<span class="string">&quot;trigger2&quot;</span>, <span class="string">&quot;group1&quot;</span>);  </span><br><span class="line">        trigger.setCronExpression(time);  </span><br><span class="line">        ft = sched.scheduleJob(job, trigger);  </span><br><span class="line">        System.out.println(  </span><br><span class="line">                job.getKey() + <span class="string">&quot; 已被安排执行于: &quot;</span> + sdf.format(ft) + <span class="string">&quot;，并且以如下重复规则重复执行: &quot;</span> + trigger.getCronExpression());  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 开始执行，start()方法被调用后，计时器就开始工作，计时调度中允许放入N个Job  </span></span><br><span class="line">        sched.start();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">// 主线程等待一分钟  </span></span><br><span class="line">            Thread.sleep(<span class="number">60L</span> * <span class="number">1000L</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 关闭定时调度，定时器不再工作  </span></span><br><span class="line">        sched.shutdown(<span class="keyword">true</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">  </span><br><span class="line">        Test test = <span class="keyword">new</span> Test();  </span><br><span class="line">        test.go();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>


<h6 id="示例2-1"><a href="#示例2-1" class="headerlink" title="示例2"></a>示例2</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 配置 **/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ScheduleTask scheduleTask;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置定时任务1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name=&quot;firstJobDetail&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MethodInvokingJobDetailFactoryBean <span class="title">firstJobDetail</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MethodInvokingJobDetailFactoryBean method = <span class="keyword">new</span> MethodInvokingJobDetailFactoryBean();</span><br><span class="line">        <span class="comment">// 为需要执行的实体类对应的对象</span></span><br><span class="line">        method.setTargetObject(scheduleTask);</span><br><span class="line">        <span class="comment">// 需要执行的方法</span></span><br><span class="line">        method.setTargetMethod(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="comment">// 是否并发执行</span></span><br><span class="line">        method.setConcurrent(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> method;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *   配置触发器1</span></span><br><span class="line"><span class="comment">     *   <span class="doctag">@param</span> firstJobDetail</span></span><br><span class="line"><span class="comment">     *   <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name=&quot;firstTrigger&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleTriggerFactoryBean <span class="title">firstTrigger</span><span class="params">(JobDetail firstJobDetail)</span></span>&#123;</span><br><span class="line">        SimpleTriggerFactoryBean simpleBean = <span class="keyword">new</span> SimpleTriggerFactoryBean();</span><br><span class="line">        simpleBean.setJobDetail(firstJobDetail);</span><br><span class="line">        <span class="comment">// 设置任务启动延迟</span></span><br><span class="line">        simpleBean.setStartDelay(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// 每1秒执行一次</span></span><br><span class="line">        simpleBean.setRepeatInterval(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//设置重复计数</span></span><br><span class="line">        <span class="comment">//simpleBean.setRepeatCount(0);</span></span><br><span class="line">        <span class="keyword">return</span> simpleBean;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  配置Scheduler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;scheduler&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SchedulerFactoryBean <span class="title">schedulerFactoryBean</span><span class="params">(Trigger firstTrigger)</span></span>&#123;</span><br><span class="line">        SchedulerFactoryBean factoryBean = <span class="keyword">new</span> SchedulerFactoryBean();</span><br><span class="line">        factoryBean.setTriggers(firstTrigger);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 定时任务 **/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleTask</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;====================================&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\11\16\22\42\JAVA设置Excel单元格格式\" rel="bookmark">JAVA设置Excel单元格格式</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\06\14\20\53\JWT授权验证\" rel="bookmark">JWT授权验证</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\10\26\23\26\Java取消Double类型显示科学计数法\" rel="bookmark">Java取消Double类型显示科学计数法</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\04\26\16\27\Java小知识\" rel="bookmark">Java小知识</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\10\26\23\27\Java的Date类型计算\" rel="bookmark">Java的Date类型计算</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Kuang
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://isdear.github.io/2020/10/31/12/14/Java%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" title="Java定时任务">http://isdear.github.io/2020/10/31/12/14/Java定时任务/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/java/" rel="tag"># java</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/10/26/23/27/Java%E7%9A%84Date%E7%B1%BB%E5%9E%8B%E8%AE%A1%E7%AE%97/" rel="prev" title="Java的Date类型计算">
                  <i class="fa fa-chevron-left"></i> Java的Date类型计算
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/11/03/23/12/exists%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" rel="next" title="exists的使用方法">
                  exists的使用方法 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kuang</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">242k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">13:27</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  




  <script src="/js/local-search.js"></script>










<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.9.0/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  

  

  

</body>
</html>
